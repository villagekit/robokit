<html>
  <head>
    <title>GridBot</title>
    <script type="text/javascript">
      var source = new EventSource('/events')

      source.addEventListener('open', function(e) {
        console.log("Events Connected")
      }, false)

      source.addEventListener('error', function(e) {
        if (e.target.readyState != EventSource.OPEN) {
          console.log("Events Disconnected")
        }
      }, false)

      source.addEventListener('message', function(e) {
        console.log("message", e.data)
      }, false)

      source.addEventListener('state', function(e) {
        let json = e.data
        let state = JSON.parse(json)
        onState(state)
      }, false)

      let ledsElement, ledsGreenElement, ledsBlueElement, ledsRedElement
      let clockElement, clockTicksElement

      document.addEventListener('DOMContentLoaded', () => {
        ledsElement = document.querySelector('.leds')
        ledsGreenElement = ledsElement.querySelector('.green')
        ledsBlueElement = ledsElement.querySelector('.blue')
        ledsRedElement = ledsElement.querySelector('.red')

        clockElement = document.querySelector('.clock')
        clockTicksElement = clockElement.querySelector('.ticks')
      })

      function onState(state) {
        console.log('state', state)
        onStateLeds(state.leds)
        onStateClock(state.clock)
      }

      function onStateLeds(state) {
        if (state.green) {
          ledsGreenElement.classList.add('on')
        } else {
          ledsGreenElement.classList.remove('on')
        }

        if (state.blue) {
          ledsBlueElement.classList.add('on')
        } else {
          ledsBlueElement.classList.remove('on')
        }

        if (state.red) {
          ledsRedElement.classList.add('on')
        } else {
          ledsRedElement.classList.remove('on')
        }
      }

      function onStateClock(state) {
        clockTicksElement.textContent = state.ticks
      }
    </script>
    <style type="text/css">
      .leds {
        display: flex;
        flex-direction: row;
      }
      .leds .led {
        height: 200px;
        width: 200px;
        border-radius: 80px;
        margin: 10px;
      }
      .leds .led {
        opacity: 0.1;
      }
      .leds .led.on {
        opacity: 1;
      }
      .leds .led.green {
        background-color: limegreen;
      }
      .leds .led.blue {
        background-color: cornflowerblue;
      }
      .leds .led.red {
        background-color: lightcoral;
      }
    </style>
  </head>
  <body>
    <h1>GridBot</h1>
    <div class="leds">
      <div class="led green"></div>
      <div class="led blue"></div>
      <div class="led red"></div>
    </div>
    <div class="clock">
      <div class="ticks"></div>
    </div>
  </body>
</html>